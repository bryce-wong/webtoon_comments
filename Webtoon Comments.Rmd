---
title: "Webtoon Comments"
author: "Bryce Wong"
date: "January 29, 2019"
output: github_document
---

```{r setup, include=FALSE}
library(rvest)
library(stringr)
library(tidyverse)
library(purrr)
library(here)
```

### Webscraping Webtoon comments 

Some things to note: 

*Will be following ethical principles as outlined [here]("https://towardsdatascience.com/ethics-in-web-scraping-b96b18136f01"").

*Finally, I have looked at Webtoon's robots.txt and it looks like I should be able to scrape comments.

###Using R Selenium to scrape Line WEBTOON comments

Reading in comments from the first episode:

Needed to download JAVA and the chrome webdriver.

```{r starting server}
library(RSelenium)
driver = rsDriver(browser = c("chrome"))
remDr = driver[["client"]]
```

TO DO:
- issue with page not fully loading
- issue with being an anchor inside a div
- FIXED IT ALL HELL YEAH

```{r}
scrape_comments = function(){
  replies <- remDr$findElements(using = "class name",  value = "u_cbox_btn_reply")
  
  for (i in 1:length(replies)) {
    replies[[i]]$sendKeysToElement(list("laptops",key = "enter"))
    Sys.sleep(1)
  }
}
```

```{r scraping}
remDr$navigate("https://www.webtoons.com/en/challenge/tested/heck-of-a-start/viewer?title_no=231173&episode_no=1")

#remDr$refresh()

Sys.sleep(10)

scrape_comments()

other_replies <- NULL

other_replies <- remDr$findElement(using = 'css',  value = "[class = 'u_cbox_next u_cbox_next_end']")

while (!is.null(other_replies)) {
  
  other_replies$clickElement()
  
  scrape_comments()

  other_replies <- remDr$findElement(using = 'css',  value = "[class = 'u_cbox_next u_cbox_next_end']")
}

Sys.sleep(2)

next_page <- NULL

next_page <- remDr$findElement(using = 'css',  value = "[class = 'pg_next _nextEpisode NPI=a:next,g:en_en']")

Sys.sleep(2)

if (!is.null(next_page)) {
  next_page$clickElement()
}
```

```{r stop server}
remDr$close()
driver$server$stop()
driver$server$process
```




